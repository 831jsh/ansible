---
## Setup vnstat on a debian server.
## I need a user account which is able to sudo without password

- hosts: nodes
  sudo: True
  user: remy

  vars:
    interface: ${ansible_default_ipv4.interface}
    interface2: ${ansible_default_ipv4.alias}
    ipaddr: ${ansible_default_ipv4.address}

  tasks:
  - name: Install packages
    action: apt name=$item state=latest
    with_items:
     - vnstat

  - name: Set up vnstat config file
    action: template src=config/vnstat.conf.in dest=/etc/vnstat.conf mode=0755 owner=root group=root
    notify: restart vnstat

  - name: Ininitalize vnstat
    action: command sudo vnstat -u -i $interface

  handlers:
    - name: restart vnstat
      action: service name=vnstat state=restarted